<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Enhanced Planner - Calendar & Timer App</title>
  <style>
    /* General Styling */
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #1d1f21, #282b30);
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      min-height: 100vh;
    }
    .container {
      max-width: 900px;
      width: 100%;
      margin-top: 20px;
    }
    .section {
      background: #333;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
      margin-bottom: 20px;
      color: #00ffcc;
    }

    /* Navbar */
    nav {
      width: 100%;
      background: #444;
      padding: 15px;
      text-align: center;
    }
    nav h1 {
      font-size: 1.5em;
      font-weight: bold;
    }

    /* Current Time */
    #currentTime {
      font-size: 1.5em;
      margin-top: 10px;
    }

    /* Calendar */
    #calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 5px;
    }
    .day {
      background: #444;
      padding: 10px;
      border-radius: 5px;
      transition: background 0.3s;
      cursor: pointer;
    }
    .day:hover {
      background: #555;
    }
    .task-day {
      background: #00aaff; /* Color for days with tasks */
    }
    .past-due {
      background: #ff5555; /* Color for past-due tasks */
    }
    .today {
      background: #00ffcc; /* Highlight for today's date */
      color: #000;
    }

    /* Timer */
    .timer-container input {
      width: 50px;
      padding: 5px;
      font-size: 1em;
      margin: 5px;
      text-align: center;
    }
    .timer-buttons button {
      padding: 10px 15px;
      margin: 5px;
      font-size: 1em;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .start { background: #28a745; }
    .pause { background: #ffc107; }
    .reset { background: #dc3545; }

    /* Task List */
    .task-list ul {
      list-style-type: none;
      padding: 0;
    }
    .task-list li {
      padding: 5px;
      margin: 5px 0;
      background: #222;
      border-radius: 5px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .task-list input[type="checkbox"] {
      margin-right: 10px;
    }
    .remove-btn {
      background: #ff5555;
      border: none;
      padding: 5px;
      cursor: pointer;
      border-radius: 5px;
      color: #fff;
    }
  </style>
</head>
<body>

<!-- Navbar -->
<nav>
  <h1>Mahdin Planner - Calendar & Timer App</h1>
</nav>

<div class="container">

  <!-- Current Time Display -->
  <div id="currentTime" class="section"></div>

  <!-- Calendar with Task List -->
  <div class="section">
    <h2>Calendar</h2>
    <div id="calendarHeader" class="text-center font-bold text-xl"></div>
    <div id="calendar"></div>
  </div>

  <!-- Task List for Selected Date -->
  <div id="taskListContainer" class="section" style="display: none;">
    <h3>Tasks for <span id="taskDate"></span></h3>
    <ul id="tasks" class="task-list"></ul>
    <button onclick="addTask()">Add Task</button>
  </div>

  <!-- Timer Section -->
  <div class="section">
    <h2>Timer with Alarm Sound</h2>
    <div class="timer-container">
      <input type="number" id="hours" placeholder="HH" min="0">
      <input type="number" id="minutes" placeholder="MM" min="0">
      <input type="number" id="seconds" placeholder="SS" min="0">
    </div>
    <div id="timerDisplay" class="text-3xl">00:00:00</div>
    <label>Upload Alarm Sound:
      <input type="file" id="soundFile" accept="audio/*">
    </label>
    <div class="timer-buttons">
      <button class="start" onclick="startTimer()">Start</button>
      <button class="pause" onclick="pauseTimer()">Pause</button>
      <button class="reset" onclick="resetTimer()">Reset</button>
    </div>
  </div>

</div>

<script>
  // Timer and Audio
  let timer;
  let totalSeconds = 0;
  let alarmSound = new Audio();
  document.getElementById('soundFile').addEventListener('change', function(event) {
    const file = event.target.files[0];
    if (file) {
      alarmSound.src = URL.createObjectURL(file);
      alarmSound.load();
    }
  });

  function startTimer() {
    const hours = parseInt(document.getElementById("hours").value) || 0;
    const minutes = parseInt(document.getElementById("minutes").value) || 0;
    const seconds = parseInt(document.getElementById("seconds").value) || 0;
    totalSeconds = hours * 3600 + minutes * 60 + seconds;
    if (totalSeconds <= 0) {
      alert("Please set a valid time!");
      return;
    }
    timer = setInterval(() => {
      if (totalSeconds <= 0) {
        clearInterval(timer);
        if (alarmSound.src) alarmSound.play();
        alert("Time's up!");
      } else {
        totalSeconds--;
        updateTimerDisplay();
      }
    }, 1000);
  }
  function updateTimerDisplay() {
    const hours = Math.floor(totalSeconds / 3600);
    const minutes = Math.floor((totalSeconds % 3600) / 60);
    const seconds = totalSeconds % 60;
    document.getElementById("timerDisplay").textContent = 
      `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
  }
  function pauseTimer() {
    clearInterval(timer);
  }
  function resetTimer() {
    clearInterval(timer);
    totalSeconds = 0;
    updateTimerDisplay();
    if (alarmSound.src) alarmSound.pause();
  }

  // Real-time Clock
  setInterval(() => {
    const now = new Date();
    document.getElementById('currentTime').textContent = now.toLocaleTimeString();
  }, 1000);

  // Calendar
  let currentYear = new Date().getFullYear();
  let currentMonth = new Date().getMonth();
  let selectedDay = null;
  const tasksByDate = JSON.parse(localStorage.getItem("tasksByDate")) || {};

  function renderCalendar() {
    const monthNames = ["January", "February", "March", "April", "May", "June", 
                        "July", "August", "September", "October", "November", "December"];
    document.getElementById("calendarHeader").textContent = 
      `${monthNames[currentMonth]} ${currentYear}`;
    const firstDay = new Date(currentYear, currentMonth, 1).getDay();
    const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
    const calendarDiv = document.getElementById("calendar");
    calendarDiv.innerHTML = "<div>Sun</div><div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div>";
    for (let i = 0; i < firstDay; i++) calendarDiv.innerHTML += "<div></div>";
    for (let day = 1; day <= daysInMonth; day++) {
      const dayDiv = document.createElement("div");
      dayDiv.textContent = day;
      dayDiv.classList = "day";
      if (new Date().getDate() === day && new Date().getMonth() === currentMonth && new Date().getFullYear() === currentYear) {
        dayDiv.classList.add("today");
      }
      if (tasksByDate[`${currentYear}-${currentMonth}-${day}`]) dayDiv.classList.add("task-day");
      dayDiv.addEventListener("click", () => openTaskList(day));
      calendarDiv.appendChild(dayDiv);
    }
  }

  // Tasks
  function openTaskList(day) {
    selectedDay = day;
    const taskListContainer = document.getElementById("taskListContainer");
    taskListContainer.style.display = "block";
    const dateKey = `${currentYear}-${currentMonth}-${day}`;
    document.getElementById("taskDate").textContent = dateKey;
    const tasks = tasksByDate[dateKey] || [];
    renderTasks(tasks);
  }

  function renderTasks(tasks) {
    const taskUl = document.getElementById("tasks");
    taskUl.innerHTML = "";
    tasks.forEach((task, index) => {
      const taskLi = document.createElement("li");
      const taskCheckbox = document.createElement("input");
      taskCheckbox.type = "checkbox";
      taskCheckbox.checked = task.completed;
      taskCheckbox.addEventListener("change", () => toggleTaskComplete(index));
      const taskText = document.createElement("span");
      taskText.textContent = task.text;
      const removeBtn = document.createElement("button");
      removeBtn.textContent = "Remove";
      removeBtn.classList.add("remove-btn");
      removeBtn.addEventListener("click", () => removeTask(index));
      taskLi.append(taskCheckbox, taskText, removeBtn);
      taskUl.appendChild(taskLi);
    });
  }

  function addTask() {
    const taskText = prompt("Enter a task:");
    if (taskText) {
      const dateKey = `${currentYear}-${currentMonth}-${selectedDay}`;
      tasksByDate[dateKey] = tasksByDate[dateKey] || [];
      tasksByDate[dateKey].push({ text: taskText, completed: false });
      localStorage.setItem("tasksByDate", JSON.stringify(tasksByDate));
      renderTasks(tasksByDate[dateKey]);
      renderCalendar();
    }
  }

  function toggleTaskComplete(index) {
    const dateKey = `${currentYear}-${currentMonth}-${selectedDay}`;
    tasksByDate[dateKey][index].completed = !tasksByDate[dateKey][index].completed;
    localStorage.setItem("tasksByDate", JSON.stringify(tasksByDate));
  }

  function removeTask(index) {
    const dateKey = `${currentYear}-${currentMonth}-${selectedDay}`;
    tasksByDate[dateKey].splice(index, 1);
    if (tasksByDate[dateKey].length === 0) delete tasksByDate[dateKey];
    localStorage.setItem("tasksByDate", JSON.stringify(tasksByDate));
    renderTasks(tasksByDate[dateKey] || []);
    renderCalendar();
  }

  renderCalendar();
</script>

</body>
</html>
